# Kanban Application Deployment Guide (Heroku)

This guide will walk you through deploying the Kanban application to Heroku.

## 1. Prerequisites

Before you begin, ensure you have the following installed:
- **Git:** [Download Git](https://git-scm.com/downloads)
- **Node.js and npm:** [Download Node.js](https://nodejs.org/) (npm is included)
- **Heroku CLI:** [Install Heroku CLI](https://devcenter.heroku.com/articles/heroku-cli)

You should also have:
- A **MongoDB Atlas account** with a cluster set up and your connection string ready (as per `MONGODB_ATLAS_SETUP_INSTRUCTIONS.txt`).
- The application code cloned to your local machine.

## 2. Preparing Your Application

### a. Check `package.json`
Ensure your `package.json` file has the following:

- **Start Script:** This tells Heroku how to start your application.
  ```json
  "scripts": {
    "start": "node src/index.js",
    "build:css": "tailwindcss -i ./src/public/css/tailwind.css -o ./src/public/css/style.css"
    // other scripts...
  },
  ```
  Heroku typically runs `npm start`. We also need to ensure our CSS is built. Heroku can run a `heroku-postbuild` script.

- **Engines:** Specify the Node.js and npm versions (use versions similar to your development environment).
  ```json
  "engines": {
    "node": "18.x", // Or your preferred LTS version like "16.x", "20.x"
    "npm": "9.x"   // Corresponding npm version
  },
  ```

### b. Update `package.json` for Heroku Build
Heroku needs to build the Tailwind CSS. Add a `heroku-postbuild` script to your `package.json`:
```json
"scripts": {
  "start": "node src/index.js",
  "build:css": "tailwindcss -i ./src/public/css/tailwind.css -o ./src/public/css/style.css",
  "heroku-postbuild": "npm run build:css" // This will run after dependencies are installed
  // other scripts...
},
```

### c. `.gitignore` File
Ensure your `.gitignore` file includes at least the following to prevent committing unnecessary files:
```
node_modules/
.env
npm-debug.log
*.env
/src/public/css/style.css # This will be generated by Heroku
```
*(Note: We commit `tailwind.config.js`, `postcss.config.js` and `src/public/css/tailwind.css` (the input file) as they are needed for the build process).*

### d. Environment Variables
Your application uses environment variables for sensitive data:
- `MONGODB_URI`: Your MongoDB Atlas connection string.
- `SESSION_SECRET`: A secret key for session management.

**Do not hardcode these in your application.** You will set them as "Config Vars" in Heroku.

## 3. Heroku Deployment Steps

### a. Login to Heroku
Open your terminal or command prompt and run:
```bash
heroku login
```
This will open a browser window for you to log in.

### b. Create a Heroku Application
Navigate to your project's root directory in the terminal. If you haven't already, initialize a Git repository:
```bash
git init
git add .
git commit -m "Initial commit for Heroku deployment"
```

Then, create a new Heroku app:
```bash
heroku create your-unique-app-name
```
If you omit `your-unique-app-name`, Heroku will generate a random one for you.

### c. Set Config Vars
Set the necessary environment variables in Heroku. Replace placeholders with your actual values.

- **MONGODB_URI:**
  ```bash
  heroku config:set MONGODB_URI="mongodb+srv://<username>:<password>@<your-cluster-url>/<dbname>?retryWrites=true&w=majority"
  ```
  (**Important:** Ensure your MongoDB Atlas cluster's IP whitelist allows connections from all IPs (0.0.0.0/0) as Heroku app IPs are dynamic. For better security, explore options like VPC peering or PrivateLink if available on your Atlas tier and Heroku plan, though these are advanced features.)

- **SESSION_SECRET:** Generate a strong, random string for your session secret. You can use an online generator or a command like `openssl rand -base64 32`.
  ```bash
  heroku config:set SESSION_SECRET="your_very_strong_random_session_secret"
  ```

You can verify them by running `heroku config`.

### d. Deploy Your Code
Push your code to Heroku:
```bash
git push heroku main
```
(If your main branch is named `master`, use `git push heroku master`).

Heroku will then build your application, install dependencies (running `npm install`), and run the `heroku-postbuild` script (which runs `npm run build:css`), then start it using `npm start`.

### e. Open Your Application
Once the deployment is complete, you can open your application in your browser:
```bash
heroku open
```

## 4. Troubleshooting

- **View Logs:** If your application fails to start or you encounter errors, check the Heroku logs:
  ```bash
  heroku logs --tail
  ```
- **Build Issues:** If the `heroku-postbuild` script fails, check the build log for errors related to Tailwind CSS or other dependencies. Ensure `tailwindcss`, `postcss`, and `autoprefixer` are in your `devDependencies` in `package.json`.
- **Application Errors:** Review the logs for any runtime errors in your Node.js code.
- **`PORT` Variable:** Heroku assigns the `PORT` dynamically. Your `src/index.js` already uses `process.env.PORT || 3000`, which is correct.
- **Database Connection:** Double-check your `MONGODB_URI` and IP whitelist settings in MongoDB Atlas.

## 5. Next Steps & Considerations

- **Custom Domain:** You can configure a custom domain for your Heroku app.
- **Scaling:** Heroku allows you to scale your application dynos if you need more resources (paid feature).
- **Security:**
    - Regularly update your `SESSION_SECRET`.
    - Review MongoDB Atlas security best practices.
    - Consider adding HTTPS redirection (Heroku usually handles this at the load balancer level for free dynos).
    - Implement CSRF protection (e.g., using `csurf` package) for enhanced security against cross-site request forgery.
- **Backups:** Regularly back up your MongoDB Atlas database.

Congratulations! Your Kanban application should now be deployed on Heroku.
```
